---
title: "Using knitractive with Bash"
author: "Jeroen Janssens"
date: "`r Sys.Date()`"
output: github_document
---

*View the corresponding [bash.Rmd file](https://raw.githubusercontent.com/datascienceworkshops/knitractive/master/vignettes/examples/bash.Rmd).*

```{r setup, include = FALSE}
# options(tmux_echo = TRUE)
knitractive::start(name = "bash",
                   command = rexpect::cmd_docker(image = "datasciencetoolbox/dsatcl2e"),
                   prompt = rexpect::prompts$bash)
```

```{bash, include=FALSE}
bash
PS1='$ '
```

## Set a variable

```{bash set_name}
NAME=$(whoami)
```

## Spread a pipeline over multiple lines

```{bash multiple}
echo "grep"
seq 100 |
grep 3 |
wc -l
```

## Retrieve a value

```{bash get_name}
cowsay "I am ${NAME}"
```

## Command substitution

```{bash iris}
alias
mkdir test && cd test
curl -sL http://bit.ly/iris-csv > iris.csv
l
echo "Iris has $(< iris.csv wc -l) lines"
head iris.csv | csvlook
```

## Take a screenshot of `htop`

```{bash run_htop}
htop #! literal = FALSE
```

After two seconds we see the following screen:

```{bash start_htop, highlight = FALSE, fullscreen = TRUE}
Enter #! literal = FALSE, hold = 3
```
```{bash exit_htop, include = FALSE}
F10 #! literal = FALSE
```

Press **F10** or **q** to exit `htop`. 

## Send interrupt 

We can simulate pressing **CTRL-C** to quit long-running processes:

```{bash sleep, keep_last_prompt = TRUE}
sleep 1000 #! expect_prompt = FALSE
C-c #! wait = 1, literal = FALSE, expect_prompt = TRUE
```
